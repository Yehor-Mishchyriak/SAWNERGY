CI/CD quickstart for Sawnergy
============================

Initial one-time setup
----------------------
1. Ensure the deploy script is executable:
       chmod +x CICD/deploy.sh
2. Add the public mirror remote (adjust the URL to your public GitHub repo):
       git remote add public git@github.com:Yehor-Mishchyriak/sawnergy-public.git
3. Install build/test requirements inside your virtualenv:
       pip install -r requirements.txt
   (The CI scripts expect `pytest`, `setuptools`, `twine`, etc. to be importable.)

Day-to-day commands
-------------------
• Run the test suite locally:
       python -m pytest

• Build source and wheel distributions (version auto-bumped in `pkg_meta.json`):
       python CICD/build_whl.py sdist bdist_wheel
   Artifacts are placed in `dist/`.

Automated deploy pipeline
-------------------------
`CICD/deploy.sh` orchestrates the standard release flow:
   Tests → build → (optional) upload to PyPI → push to development remote → publish curated branch to public remote.

Usage:
A) Test + build + push (no upload)
bash CICD/deploy.sh

# To build the JOSS PDF via GitHub Actions:
# - ensure .github/workflows/joss-draft.yml is present on the branch you push
# - push changes to JOSS/paper.md or JOSS/paper.bib (or images under JOSS/)
# - or trigger manually from the Actions tab (JOSS PDF Draft -> Run workflow)

B) Test + build + upload to PyPI
       export PYPI_API_TOKEN="pypi-XXXXXXXXXXXXXXXX"
       UPLOAD=1 bash CICD/deploy.sh

C) Upload to TestPyPI instead
       export PYPI_API_TOKEN="pypi-XXXXXXXXXXXXXXXX"
       export TWINE_REPOSITORY_URL="https://test.pypi.org/legacy/"
       UPLOAD=1 bash CICD/deploy.sh

Script defaults
---------------
• Development remote: `origin` (override with `DEV_REMOTE`).
• Public remote: `public` (override with `PUBLIC_REMOTE`).
• Dev push branch: `main` (`DEV_PUSH_BRANCH`).
• Release branch prefix: `Sawnergy-release-v` (`PUBLIC_REL_PREFIX`).

The deploy script bumps `pkg_meta.json["version"]` by +0.1 before packaging. It commits that change if necessary and
creates a tag `vX.Y`. It also force-updates two branches on the public remote: the versioned release branch and the
public main.

Recommended workflow
--------------------
• Do regular development on feature branches, merge into `origin/main` when ready.
• Run `bash CICD/deploy.sh` only when you want to cut a release.
• Protect `origin/main` / public branches as needed—deploy only pushes once tests pass.
